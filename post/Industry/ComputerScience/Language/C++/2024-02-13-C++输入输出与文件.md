---
title: C++输入、输出与文件
author: AshGrey
date: 2024-02-13 00:00:00 +0800
categories: [Computer Science, Language]
tags: [Computer Science, C++]
---

<br>

> 本文章所属领域：
>
> [实践产业知识 - 工业产业 - 计算机科学 - 编程语言 - C++]({% post_url /Computer Science/2024-02-08-计算机科学：索引笔记 %})
>
> 本文章所需前置知识：
>
> - [C++基础知识]({% post_url /Computer Science/Language/2024-02-08-C++基础知识笔记 %})
{: .prompt-info}

<br>

## 1 流和缓冲区

C++程序把输入和输出看作字节流，输入时程序从输入流中抽取字节，输出时将字节插入输出流中。对于面向文本的程序，每个字节代表一个字符，字节可以构成字符或者数值数据的二进制表示。输入流中的字节可能来自键盘、存储设备或其他程序；输出流中的字节可以流向屏幕、打印机、存储设备和其他程序。**流充当了程序和流源或流目标之间的桥梁**。

使用缓冲区可以更高效处理输入与输出。缓冲区是用作中介的内存块，它将信息从设备传输到程序或从程序传输给设备的临时存储工具。程序输出时首先填满缓冲区，然后把整块数据传输到硬盘中，并清空缓冲区以备下一批输出使用，这称为**刷新缓冲区**。对于键盘输入，C++程序通常在用户按下回车键时刷新缓冲区。

C++中的`iostream`文件包含专门设计用来实现、管理流和缓冲区的类：
- `streambuf`类：为缓冲区提供内存，提供用于填充缓冲区、访问缓冲区内容、刷新缓冲区和管理缓冲区内存的类方法；
- `ios_base`类：表示流的一般特征，如是否可读取，是二进制流还是文本流等；
- `ios`类：基于`ios_base`类，其中包括一个指向`streambuf`对象的指针成员；
- `ostream`类：派生自`ios`类，提供输出方法；
- `istream`类：派生自`ios`类，提供输入方法；
- `iostream`类：基于`ostream`类和`istream`类，继承了输入与输出方法。

<br>

<br>

<br>

## 2 使用`cin`处理输入

`istream`类重载了抽取运算符`<<`使得能够识别不同的基本类型，这种运算符函数称为**格式化输入函数**，它们可以将输入数据转换为目标指定的格式，典型的运算符函数原型如下：

``` cpp
istream& operator >> (int&);
```

由于参数类型为引用，`cin`能够直接修改用作参数的变量的值。同时C++还重载了字符指针类型重载了抽取运算符，抽取运算符将读取输入中的下一个单词，将它放置到指定的地址并加上一个`\n`字符使之成为一个字符串。

### 2.1 检查输入

不同版本的抽取运算符查看输入流的方法是相同的，它们跳过空白（空格、换行符和制表符），直到遇到非空白字符，即使对于单字符模式（参数类型为`char`、`unsigned char`或者`signed char`）情况也是如此。`>>`运算符将读取一个指定类型的数据，例如对于代码

``` cpp
int input;
std::cin >> input;
```

当键入字符`-123Z`时，`-123`是`int`类型的有效值，因此`>>`将读取到`Z`并将`-123`存入`input`变量中。当输入没有满足程序的期望时，抽取运算符将不会修改变量的值并返回`0`（`istream`对象的错误状态被设置，可以使用`if`或者`while`语句检测对象是否为`false`）：

``` cpp
while (std::cin >> input)
    sum += input;
```

### 2.2 流状态

`cin`和`cout`对象包含一个描述流状态的数据成员（从`ios_base`类中继承的），流状态被定义为`iostate`类型，它由三个`ios_base`元素构成：`eofbit`、`badbit`和`failbit`。

|成员|描述|
|:---:|:---:|
|`eofbit`|如果到达文件尾，设置为`1`|
|`badbit`|如果流被破坏，例如文件读取错误时，设置为`1`|
|`failbit`|如果输入操作未能读取预期的字符类型或者输出操作没有写入预期的字符，设置为`1`|
|`goodbit`|表示`0`的另一种方法|
|`good()`|如果流的所有位都设置位`0`，可以使用，返回`true`|
|`eof()`|如果`eofbit`被设置为`1`，返回`true`|
|`bad()`|如果`badbit`被设置为`1`，返回`true`|
|`fail()`|如果`failbit`被设置为`1`，返回`true`|
|`rdstate()`|返回流状态|
|`exceptions()`|返回一个位掩码，指出哪些标记导致异常被引发|
|`exceptions(iostate ex)`|使用该函数时，设置`ex`状态时，`clear()`函数将引发异常|
|`clear(iostate s)`|将流状态设置为`s`，`s`中没有的元素设置为`0`，`s`的默认值为`goodbit`|
|`setstate(iostate s)`|设置与`s`中设置的位对应的流状态位，其他流状态位保持不变|

设置流状态位将使后面的输入或者输出关闭，直到位被清除。如果希望程序在流状态位被设置后能够读取后面的输入，就必须使用`clear()`方法将流状态设置为良好


